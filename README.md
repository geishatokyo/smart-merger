# このライブラリーの目的

ファイルをマージするためのライブラリです。  
コードジェネレーションによって生成されたファイルと、手で編集されたファイルを上手くマージして、
コードジェネレーションを絡めた開発を支援することを目的としています。


# 使い方 

## Hold merge

holdタグの中身を保持したまま、ファイルをマージする方法です。

まず、マージ元として以下のようなファイルを用意します。
各holdタグには名前を付けることができます。

User.scala

    class User{
        def autoGeneratedCode = {
          throw new Exception()
        }
        //@hold[my_impls]
        
        def userCreatedMethod = {
          println("I made!")
        }
        
        //@end
    }
    
   

次に以下の様なコードでマージを行います。

    import com.geishatokyo.smartmerger.Merger
    import java.io.File
    
    
    val merger = Merger.forScala
    merger.holdMerge(new File("User.scala"),"""
    class User{
        def autoGeneratedCode = {
          println("Fix bug")
        }
        //@hold[my_impls]
        
        //@end
    }""")
    
    
結果、User.scalaは次のようにマージされます。

User.scala

    class User{
        def autoGeneratedCode = {
          println("Fix bug")
        }
        //@hold[my_impls]
        
        def userCreatedMethod = {
          println("I made!")
        }
        
        //@end
    }


## Replace merge


replaceタグの中身だけを置き換えるマージです。
また、insertタグを使うことにより、その場所へのコードの挿入を行うことも可能です。

まず、マージ元として以下のようなファイルを用意します。

User.scala

    class User{
       def IMakeAlmostEveryMethod() = {
         println("I made")
       }
    
        //@replace[method]
        
        def generatedMethod() = {
        }
        
        //@end
        
        //@insert[insertMethod]
   
    }
    
マージは以下のコードで行います


    import com.geishatokyo.smartmerger.Merger
    import com.geishatokyo.smartmerger.injection.InjectionData
    import com.geishatokyo.smartmerger.dsl.Implicits._
    import java.io.File
    
    
    val merger = Merger.forScala
    val injection = InjectionData(
      replace("method") to """  def generatedMethod() = println("impl!")""",
      replace("insertMethod") to """  def insertedMethod() = println("inserted")""",
      replace("insertMethod") to """  def notInserted""" ifNotContains "IMakeAlmostEveryMethod" 
    merger.replaceMerge(new File("User.scala"),
      injection,
      """... code for default"""
    )
    
結果は以下のようになります。
notInsertedは、条件として"IMakeAlmostEveryMethod"が含まれない場合のみinsertされることになります。
この条件は、手動で同名のメソッドを追加した場合に、コードジェネレーションにより再度生成されないようにするために利用できます。


User.scala

    class User{
       def IMakeAlmostEveryMethod() = {
         println("I made")
       }
    
        //@replace[method]
        def generatedMethod() = println("impl!")
        //@end
        
        //@insert[insertMethod]
        def insertedMethod() = println("inserted")
    }