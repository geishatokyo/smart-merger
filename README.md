# このライブラリーの目的

ファイルをマージするためのライブラリです。  
コードジェネレーションによって生成されたファイルと、手で編集されたファイルを上手くマージして、
コードジェネレーションを絡めた開発を支援することを目的としています。


# 使い方 

## Hold merge

holdタグの中身を保持したまま、ファイルをマージする方法です。

まず、マージ元として以下のようなファイルを用意します。
各holdタグには名前を付けることができます。

User.scala

    class User{
        def autoGeneratedCode = {
          throw new Exception()
        }
        //@hold[my_impls]
        
        def manuallyMadeMethod = {
          println("I made it!")
        }
        
        //@end
    }
    
   

次に以下の様なコードでマージを行います。

    import com.geishatokyo.smartmerger.Merger
    import java.io.File
    
    
    val merger = Merger.forScala
    merger.holdMerge(new File("User.scala"),"""
    class User{
        def autoGeneratedCode = {
          println("Fix bug")
        }
        //@hold[my_impls]
        
        //@end
    }""")
    
    
結果、User.scalaは次のように、上書くファイルがベースになり、上書かれるファイルのholdタグ内のみが残ります。。

User.scala

    class User{
        def autoGeneratedCode = {
          println("Fix bug")
        }
        //@hold[my_impls]
        
        def manuallyMadeMethod = {
          println("I made it!")
        }
        
        //@end
    }


## Replace merge


replaceタグの中身だけを置き換えるマージです。
また、insertタグを使うことにより、その場所へのコードの挿入を行うことも可能です。

まず、マージ元として以下のようなファイルを用意します。

User.scala

    class User{
       def IMakeAlmostEveryMethod() = {
         println("I made")
       }
    
        //@replace[method]
        
        def generatedMethod() = {
        }
        
        //@end
        
        //@insert[insertMethod]
   
    }
    
マージは以下のコードで行います


    import com.geishatokyo.smartmerger.Merger
    import com.geishatokyo.smartmerger.injection.Injection
    import java.io.File
    
    
    val merger = Merger.forScala
    val injections = List(
      Injection("method","""  def generatedMethod() = println("impl!")"""),
      Injection("insertMethod","""  def insertedMethod() = println("inserted")"""),
      Injection("insertMethod","""  def notInserted""") ifNotContains "IMakeAlmostEveryMethod"
    )
    merger.replaceMerge(new File("User.scala"),
      injections
    )
    
結果は以下のようになります。
notInsertedは、条件としてマージ対象ファイル中に"IMakeAlmostEveryMethod"が含まれない場合のみinsertされることになります。
この機能は、手動で同名のメソッドを追加した場合に、コードジェネレーションにより再度生成されないようにするために利用できます。


User.scala

    class User{
       def IMakeAlmostEveryMethod() = {
         println("I made")
       }
    
        //@replace[method]
        def generatedMethod() = println("impl!")
        //@end
        
        //@insert[insertMethod]
        def insertedMethod() = println("inserted")
    }


## Skip merge

ファイル中に

    //@skip_merge

のタグが含まれる場合、そのファイルはマージ対象になりません。
自動生成をOffにしたいファイルに記述して下さい。



# プログラム言語対応

ラインコメントに、ダブルスラッシュ//以外を使う言語中で使う場合は、

   Merger.forXXX

に定義されているMergerを使ってください。